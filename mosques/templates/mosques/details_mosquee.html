{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ mosque.name }} - DJAMAA.DZ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <!-- CSS Lightbox (toujours charger) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe.min.css">

    <style>
        :root { --primary-green: #2e7d32; --dark-green: #1b5e20; }
        body { font-family: 'Inter', sans-serif; background: #f8faf8; }

        /* --- NAVBAR HARMONIS√âE (STYLE PILL) --- */
        .navbar {
            background: rgba(255, 255, 255, 0.9) !important;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 100px;
            padding: 0.6rem 1.5rem !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            max-width: 1150px;
            margin: 0 auto;
        }
        .navbar-container { position: fixed; top: 20px; left: 0; right: 0; z-index: 1050; padding: 0 15px; }

        .date-stack {
            font-size: 0.75rem; line-height: 1.2; border-left: 2px solid #eee;
            padding-left: 15px; margin-left: 15px; display: flex; flex-direction: column; justify-content: center;
        }

        .nav-link { font-weight: 600; color: #333 !important; border-radius: 50px; padding: 0.6rem 1rem !important; font-size: 0.9rem; }
        .nav-link:hover { background: rgba(46, 125, 50, 0.1); color: var(--primary-green) !important; }
        .nav-admin-btn { background: #fff5f5; color: #e03131 !important; border: 1px solid #ffc9c9; margin-left: 10px; }

        /* --- STYLE CONTENU --- */
        .content-container { margin-top: 130px; padding-bottom: 50px; }
        .card-details { border-radius: 25px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .text-history { white-space: pre-wrap; line-height: 1.7; color: #444; text-align: justify; }
        .badge-wilaya { background: var(--primary-green); color: white; border-radius: 50px; padding: 5px 15px; font-size: 0.9rem; }

        /* Style pour les photos Lightbox */
        .photo-thumbnail {
            height: 180px;
            width: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .photo-thumbnail:hover {
            transform: scale(1.03);
        }

        /* Alignement automatique selon la langue */
        [dir="rtl"] .text-history,
        [dir="rtl"] h1,
        [dir="rtl"] h4,
        [dir="rtl"] p {
            text-align: right !important;
        }

        /* Inversion des marges des ic√¥nes en Arabe */
        [dir="rtl"] .bi {
            margin-left: 10px !important;
            margin-right: 0 !important;
        }

        /* Ajustement de la bordure de la date dans la navbar */
        [dir="rtl"] .date-stack {
            border-left: none;
            border-right: 2px solid #eee;
            padding-left: 0;
            padding-right: 15px;
            margin-left: 0;
            margin-right: 15px;
        }

        /* --- INTERFACE PHOTOSWIPE HARMONIS√âE --- */

        /* --- INTERFACE PHOTOSWIPE HARMONIS√âE (CORRIG√âE) --- */

        /* 1. Conteneur des boutons Zoom (PhotoSwipe force absolute sur les enfants) */
        .pswp__zoom-controls {
            position: absolute !important;
            top: 15px !important;
            left: 15px !important;
            z-index: 99999 !important;
            width: 44px !important;
            height: auto !important;
            transform: none !important;
        }

        /* 2. Bouton ZOOM + */
        .pswp__button--zoom-in {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            background: rgba(46, 125, 50, 0.95) !important;
            color: white !important;
            font-size: 20px !important;
            font-weight: bold !important;
            width: 42px !important;
            height: 42px !important;
            border-radius: 10px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3) !important;
            cursor: pointer !important;
            border: none !important;
        }

        /* 3. Bouton ZOOM - (espac√© volontairement) */
        .pswp__button--zoom-out {
            position: absolute !important;
            top: 56px !important; /* ‚Üê ESPACE R√âEL ENTRE + ET - */
            left: 0 !important;
            background: rgba(46, 125, 50, 0.95) !important;
            color: white !important;
            font-size: 20px !important;
            font-weight: bold !important;
            width: 42px !important;
            height: 42px !important;
            border-radius: 10px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3) !important;
            cursor: pointer !important;
            border: none !important;
        }

        /* 4. Couleur de survol (diff√©rente du vert de base) */
        .pswp__button--zoom-in:hover,
        .pswp__button--zoom-out:hover {
            background: #00a884 !important; /* vert √©meraude moderne */
        }

        /* 5. Compteur PhotoSwipe ‚Äì Style pill discret */
        .pswp__counter {
            position: absolute !important;
            left: auto !important;
            right: 80px !important;
            top: 18px !important;
            background: rgba(255, 204, 0, 0.9) !important;
            backdrop-filter: blur(8px);
            color: #000000 !important;
            font-weight: 600 !important;
            font-size: 0.85rem !important;
            padding: 4px 16px !important;
            border-radius: 30px !important;
            border: 1px solid rgba(255, 255, 255, 0.25) !important;
            height: 34px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 99999 !important;
        }


        /* ‚úÖ STYLE GARANTI POUR LA L√âGENDE PHOTOSWIPE */
        .pswp__caption {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            position: fixed !important; /* fixed au lieu de absolute */
            bottom: 0 !important;
            left: 0 !important;
            width: 100% !important;
            background: rgba(0, 0, 0, 0.85) !important;
            color: white !important;
            padding: 18px 20px !important;
            text-align: center !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            min-height: 60px !important;
            z-index: 2000 !important;
            box-sizing: border-box !important;
        }

        .pswp__caption__center {
            max-width: 800px !important;
            margin: 0 auto !important;
            line-height: 1.5 !important;
            font-size: 16px !important;
        }

        /* Cache le bouton "tap to toggle" qui pourrait cacher la l√©gende */
        .pswp__tap-to-close {
            display: none !important;
        }

    </style>
</head>
<body>

    <div class="navbar-container">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="/" style="color: var(--primary-green);">
                    <i class="bi bi-mosque-fill me-2"></i>
                    <span>DJAMAA<span class="text-dark">.DZ</span></span>
                </a>

                <div class="date-stack d-none d-lg-flex">
                    <div class="text-muted small">
                        <i class="bi bi-calendar3 me-1"></i> <span id="nav-date-gregorian"></span>
                    </div>
                    <div class="text-success fw-bold small">
                        <i class="bi bi-moon-stars-fill me-1"></i> <span id="nav-date-hijri"></span>
                    </div>
                </div>

                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}"><i class="bi bi-house-door me-1"></i> {% trans "Accueil" %}</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'proposer' %}"><i class="bi bi-plus-circle me-1"></i> {% trans "Proposition" %}</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'carte' %}"><i class="bi bi-map me-1"></i> {% trans "Carte" %}</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'panorama' %}"><i class="bi bi-geo-alt me-1"></i> {% trans "Panorama" %}</a></li>

                        {% if user.is_staff %}
                            <li class="nav-item">
                                <a class="nav-link nav-admin-btn" href="{% url 'admin:index' %}">
                                    <i class="bi bi-shield-lock me-1"></i> {% trans "Administrateur" %}
                                </a>
                            </li>
                        {% endif %}

                        {% get_current_language as CURRENT_LANG %}

                        <li class="nav-item dropdown ms-lg-2">
                            <a class="nav-link dropdown-toggle shadow-sm" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                               style="background: #2e7d32; color: white !important; border-radius: 50px; padding: 5px 12px !important; font-size: 0.85rem; font-weight: bold; display: inline-flex; align-items: center; border: none;">

                                <i class="bi bi-translate me-2"></i>

                                <span>
                                     {% if CURRENT_LANG == 'ar' %}
                                        AR üá©üáø
                                    {% elif CURRENT_LANG == 'en' %}
                                         EN üá¨üáß
                                    {% else %}
                                         FR üá´üá∑
                                    {% endif %}
                                </span>
                            </a>

                            <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 mt-2" aria-labelledby="langDropdown" style="border-radius: 12px; min-width: 150px;">
                                <li>
                                    <form action="{% url 'set_language' %}" method="post" class="m-0">
                                        {% csrf_token %}
                                        <input name="next" type="hidden" value="{{ request.get_full_path }}">
                                        <button type="submit" name="language" value="fr" class="dropdown-item d-flex justify-content-between {% if CURRENT_LANG == 'fr' %}fw-bold text-success{% endif %}">
                                            <span>Fran√ßais</span> {% if CURRENT_LANG == 'fr' %}‚úì{% endif %}
                                        </button>
                                    </form>
                                </li>
                                <li>
                                    <form action="{% url 'set_language' %}" method="post" class="m-0">
                                        {% csrf_token %}
                                        <input name="next" type="hidden" value="{{ request.get_full_path }}">
                                        <button type="submit" name="language" value="ar" class="dropdown-item d-flex justify-content-between text-end {% if CURRENT_LANG == 'ar' %}fw-bold text-success{% endif %}">
                                            {% if CURRENT_LANG == 'ar' %}‚úì{% endif %} <span>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                                        </button>
                                    </form>
                                </li>
                                <li>
                                    <form action="{% url 'set_language' %}" method="post" class="m-0">
                                        {% csrf_token %}
                                        <input name="next" type="hidden" value="{{ request.get_full_path }}">
                                        <button type="submit" name="language" value="en" class="dropdown-item d-flex justify-content-between {% if CURRENT_LANG == 'en' %}fw-bold text-success{% endif %}">
                                            <span>English</span> {% if CURRENT_LANG == 'en' %}‚úì{% endif %}
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <div class="content-container">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card card-details p-4 p-md-5 bg-white">
                        <span class="badge-wilaya mb-3 d-inline-block">{% trans "Wilaya de" %}
                            {% if LANGUAGE_CODE == 'ar' %}{{ mosque.wilaya.name_ar }}{% else %}{{ mosque.wilaya.name_fr }}{% endif %}
                        </span>

                        <h1 class="fw-bold mb-3" style="color: var(--dark-green);">{{ mosque.name }}</h1>

                        <p class="fs-5 text-muted">
                            <i class="bi bi-geo-alt"></i>
                            <span class="small fw-bold text-uppercase" style="font-size: 0.8rem;">
                                {% if mosque.country == 'Alg√©rie' or mosque.country == 'Algeria' %}{% trans "Commune" %}{% else %}
                        {% trans "Ville" %}{% endif %} :
                            </span>
                            {{ mosque.city }}{% if mosque.village %}, {{ mosque.village }}{% endif %}
                        </p>

                        <hr class="my-4">

                        <h4 class="fw-bold text-success mb-3">{% trans "Description" %}</h4>
                        <div class="text-history mb-5">
                            {{ mosque.description|default:_("Aucune description disponible.") }}
                        </div>

                        <h4 class="fw-bold text-success mb-3">{% trans "Histoire & Particularit√©s" %}</h4>
                        <div class="text-history">
                            {{ mosque.history|default:_("L'histoire de cette mosqu√©e n'est pas encore renseign√©e.") }}
                        </div>
                    </div>


                </div>
                <div class="col-lg-4">
                    <div class="card card-details p-4 mb-4 bg-white">
                        <h5 class="fw-bold mb-3">
                            <i class="bi bi-images"></i> {% trans "Galerie Photos" %}
                            {% if mosque.photos.exists %}
                                <span class="badge bg-success ms-2">{{ mosque.photos.count }}</span>
                            {% endif %}
                        </h5>

                        {% if mosque.photos.exists %}
                            <div class="row g-2" id="gallery-zoomable">

                                {% for photo in mosque.photos.all %}
                                    {% if photo.is_approved %}
                                        <div class="col-6 col-md-4 mb-3">

                                            <!-- IMAGE avec transmission de la l√©gende √† PhotoSwipe -->
                                            <a href="{{ photo.image.url }}"
                                               data-pswp-width="1600"
                                               data-pswp-height="1200"
                                               data-pswp-caption="{{ photo.caption|default:'' }}"
                                               target="_blank">
                                                <img src="{{ photo.image.url }}"
                                                     alt="{{ photo.caption|default:'' }}"
                                                     title="{{ photo.caption|default:'' }}"
                                                     class="img-fluid rounded-3 shadow-sm photo-thumbnail">
                                            </a>

                                            <!-- L√âGENDE (NOUVEAU) -->
                                            {% if photo.caption %}
                                                <div class="text-center mt-1"
                                                     style="font-size: 0.8rem; color: #2e7d32; font-weight: 500;">
                                                    {{ photo.caption }}
                                                </div>
                                            {% endif %}

                                        </div>
                                    {% endif %}
                                {% endfor %}

                            </div>

                            <p class="small text-primary mt-2">
                                <i class="bi bi-info-circle"></i>
                                {% trans "Cliquez sur une photo pour l'agrandir" %}
                            </p>
                        {% else %}
                            <div class="text-center py-4 bg-light rounded-3">
                                <i class="bi bi-images fs-1 text-muted"></i>
                                <p class="small text-muted mt-2">{% trans "Aucune photo disponible" %}</p>
                            </div>
                        {% endif %}
                    </div>

                    <div class="card card-details p-4 bg-success text-white shadow">
                        <h5 class="fw-bold mb-3"><i class="bi bi-clock"></i> {% trans "Horaires de pri√®re" %}</h5>
                        <p class="small opacity-75">
                            {% trans "Calcul√©s pour" %} {{ mosque.city }}
                        </p>
                        <div id="prayer-times" class="small mt-2">{% trans "Chargement..." %}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function updateNavDates() {
            const today = new Date();
            const lang = "{{ LANGUAGE_CODE }}" || "fr";
            const gregElem = document.getElementById('nav-date-gregorian');
            const hijriElem = document.getElementById('nav-date-hijri');

            // 1. DATE GR√âGORIENNE
            if (gregElem) {
                gregElem.innerHTML = today.toLocaleDateString(lang, {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            }

            // 2. DATE HIJRI (API pr√©cise en arabe)
            if (!hijriElem) return;

            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');

            // Fonction asynchrone pour l'API
            async function fetchHijriDate() {
                try {
                    const response = await fetch(`https://api.aladhan.com/v1/gToH?date=${dd}-${mm}-${yyyy}`);
                    const data = await response.json();
                    if (data.code === 200) {
                        const hijri = data.data.hijri;
                        hijriElem.innerHTML = `${hijri.day} ${hijri.month.ar} ${hijri.year} ŸáŸÄ`;
                        hijriElem.dir = "rtl";
                        hijriElem.style.fontFamily = "'Segoe UI', Arial, sans-serif";
                        return;
                    }
                } catch (error) {
                    console.log("API hijri √©chou√©e, utilisant fallback");
                }

                // FALLBACK si API √©choue (votre calcul original converti en arabe)
                const hijriMonthsAr = ["ŸÖÿ≠ÿ±ŸÖ", "ÿµŸÅÿ±", "ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ£ŸàŸÑ", "ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ´ÿßŸÜŸä", "ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ£ŸàŸÑŸâ", "ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ¢ÿÆÿ±ÿ©", "ÿ±ÿ¨ÿ®", "ÿ¥ÿπÿ®ÿßŸÜ", "ÿ±ŸÖÿ∂ÿßŸÜ", "ÿ¥ŸàÿßŸÑ", "ÿ∞Ÿà ÿßŸÑŸÇÿπÿØÿ©", "ÿ∞Ÿà ÿßŸÑÿ≠ÿ¨ÿ©"];

                let day = today.getDate(), month = today.getMonth(), year = today.getFullYear();
                if (year < 1900) year += 1900;
                let m = month + 1, y = year;
                if (m < 3) {
                    y -= 1;
                    m += 12;
                }
                let a = Math.floor(y / 100), b = 2 - a + Math.floor(a / 4);
                let jd = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day + b - 1524.5;
                let z = Math.floor(jd + 0.5), cyc = Math.floor((z - 1948439.5) / 10631),
                    l = z - 1948439.5 - cyc * 10631;
                let j = Math.floor((l - 0.5) / 354.36667), h_year = cyc * 30 + j,
                    r = l - Math.floor(j * 354.36667 + 0.5);
                let h_month = Math.floor((r - 5) / 29.5);
                if (h_month < 0) h_month = 0; else if (h_month > 11) h_month = 11;
                let h_day = Math.floor(r - Math.floor(h_month * 29.5 + 0.5));

                hijriElem.innerHTML = (h_day + 1) + " " + hijriMonthsAr[h_month] + " " + (h_year + 1401) + " ŸáŸÄ";
                hijriElem.dir = "rtl";
            }

            fetchHijriDate();
        }

        // L'appel reste identique
        document.addEventListener('DOMContentLoaded', updateNavDates);

    </script>

    <script type="module">
        import PhotoSwipeLightbox
            from 'https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe-lightbox.esm.min.js';

        // ‚úÖ INITIALISATION DE PHOTOSWIPE AVEC L√âGENDES
        const lightbox = new PhotoSwipeLightbox({
            // S√©lecteur de la galerie
            gallery: '#gallery-zoomable',

            // √âl√©ments enfants cliquables (les liens <a>)
            children: 'a',

            // Chargement du module principal PhotoSwipe
            pswpModule: () => import('https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe.esm.min.js'),

            // ‚úÖ OPTIONS D'AFFICHAGE
            zoom: false,           // D√©sactive le zoom par d√©faut (vous avez vos boutons personnalis√©s)
            close: true,           // Active le bouton fermeture
            counter: true,         // Active le compteur "1/5"

            // ‚úÖ OPTION CRITIQUE : Active l'√©l√©ment HTML pour les l√©gendes
            captionEl: true,

            // ‚úÖ OPTIONS D'INTERACTION
            imageClickAction: 'close',  // Clic sur l'image = fermer
            tapAction: 'close',         // Tap sur mobile = fermer

            // ‚úÖ FONCTION CRITIQUE : R√©cup√©ration des donn√©es depuis les attributs HTML
            dataSource: function (el) {
                // DEBUG: V√©rifions ce que PhotoSwipe re√ßoit
                console.log('üì∏ dataSource appel√©e pour:', {
                    href: el.href,
                    caption: el.getAttribute('data-pswp-caption'),
                    dataset: el.dataset
                });

                return {
                    src: el.href,  // Utilisez .href au lieu de getAttribute
                    w: parseInt(el.dataset.pswpWidth) || 1600,  // dataset.pswpWidth
                    h: parseInt(el.dataset.pswpHeight) || 1200, // dataset.pswpHeight
                    title: el.dataset.pswpCaption || ''  // dataset.pswpCaption
                };
            }
        });

        // ‚úÖ AJOUT DES BOUTONS ZOOM PERSONNALIS√âS
        lightbox.on('uiRegister', function () {
            // 1. Conteneur principal pour les boutons zoom
            lightbox.pswp.ui.registerElement({
                name: 'zoom-controls',
                className: 'pswp__zoom-controls',
                appendTo: 'root',  // Attach√© √† la racine de PhotoSwipe
                html: ''  // Conteneur vide
            });

            // 2. Bouton ZOOM + (agrandir)
            lightbox.pswp.ui.registerElement({
                name: 'zoom-in-button',
                className: 'pswp__button pswp__button--zoom-in',
                appendTo: 'zoom-controls',  // Plac√© dans le conteneur zoom-controls
                isButton: true,
                html: '+',  // Texte du bouton
                onClick: (e, el, pswp) => {
                    // Agrandir de 50%
                    pswp.zoomTo(
                        pswp.currSlide.currZoomLevel * 1.5,
                        {x: pswp.viewportSize.x / 2, y: pswp.viewportSize.y / 2},
                        300  // Dur√©e de l'animation (ms)
                    );
                }
            });

            // 3. Bouton ZOOM - (r√©duire)
            lightbox.pswp.ui.registerElement({
                name: 'zoom-out-button',
                className: 'pswp__button pswp__button--zoom-out',
                appendTo: 'zoom-controls',  // Plac√© dans le conteneur zoom-controls
                isButton: true,
                html: '‚àí',  // Texte du bouton (signe moins)
                onClick: (e, el, pswp) => {
                    // R√©duire de 50%
                    pswp.zoomTo(
                        pswp.currSlide.currZoomLevel / 1.5,
                        {x: pswp.viewportSize.x / 2, y: pswp.viewportSize.y / 2},
                        300  // Dur√©e de l'animation (ms)
                    );
                }
            });
        });



        // ‚úÖ FORCER LA CR√âATION ET L'AFFICHAGE DE LA L√âGENDE
        lightbox.on('afterInit', () => {
            console.log('‚úÖ PhotoSwipe afterInit - l√©gendes activ√©es');
        });

        lightbox.on('bindEvents', () => {
            console.log('‚úÖ PhotoSwipe bindEvents');
        });

        // ‚úÖ √âV√âNEMENT LE PLUS IMPORTANT : Quand une slide est cr√©√©e
        lightbox.on('slideInit', (e) => {
            console.log('üñºÔ∏è slideInit:', {
                data: e.data,
                caption: e.slide ? (e.slide.data?.title || e.slide.data?.caption || e.slide.data?.alt || 'Sans l√©gende') : 'Slide non d√©fini'
            });

            // Force la cr√©ation de l'√©l√©ment caption s'il n'existe pas
            setTimeout(() => {
                // Utilisez l'instance PhotoSwipe principale si disponible
                const pswpInstance = lightbox.pswp || (window.pswp ? window.pswp : null);
                const captionEl = pswpInstance && pswpInstance.element ?
                  pswpInstance.element.querySelector('.pswp__caption') : null;
                if (!captionEl) {
                    console.log('‚ö†Ô∏è Cr√©ation manuelle de .pswp__caption');
                    const manualCaption = document.createElement('div');
                    manualCaption.className = 'pswp__caption';
                    manualCaption.style.cssText = `
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px;
                text-align: center;
                z-index: 10000;
                font-size: 16px;
            `;

                    const captionCenter = document.createElement('div');
                    captionCenter.className = 'pswp__caption__center';
                    const slideData = e.slide && e.slide.data ? e.slide.data : {};
                    captionCenter.textContent = slideData.title || slideData.caption || slideData.alt || '';
                    manualCaption.appendChild(captionCenter);
                    if (pswpInstance && pswpInstance.element) {
                        pswpInstance.element.appendChild(manualCaption);
                    } else {
                        console.warn('‚ö†Ô∏è Impossible d\'ajouter la l√©gende: pswp.element non disponible');
                    }
                } else {
                    // Met √† jour le texte de la l√©gende
                    const captionCenter = captionEl.querySelector('.pswp__caption__center');
                    if (captionCenter) {
                        const data = e.slide?.data || {};
                        captionCenter.textContent = data.title || data.caption || data.alt || '';
                    }
                    captionEl.style.display = 'block';
                }
            }, 100);
        });

        // ‚úÖ INITIALISATION FINALE
        lightbox.init();

        // Message de d√©bogage (optionnel)
        console.log('‚úÖ PhotoSwipe initialis√© avec l√©gendes activ√©es');
    </script>

</body>
</html>